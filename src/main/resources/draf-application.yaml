# ============================================
# Application Configuration
# ============================================

quarkus:
  application:
    name: oauth2-server
    version: 1.0.0

  # HTTP Configuration
  http:
    port: 8080
    cors:
      ~: true
      origins: "http://localhost:3000,http://localhost:8080"
      methods: "GET,POST,PUT,DELETE,OPTIONS"
      headers: "accept,authorization,content-type,x-requested-with"
      exposed-headers: "Content-Disposition"
      access-control-max-age: 24H

  # Native Image Configuration
  native:
    additional-build-args:
      - --initialize-at-run-time=com.htv.oauth2.util.CryptoUtil$SecureRandomHolder
      - --initialize-at-run-time=java.security.SecureRandom
      - -H:+ReportExceptionStackTraces
      - --enable-all-security-services
      - --allow-incomplete-classpath

  # Database Configuration
  datasource:
    db-kind: postgresql
    username: oauth2user
    password: oauth2pass
    jdbc:
      url: jdbc:postgresql://localhost:5432/oauth2db
      max-size: 16
      min-size: 4

  hibernate-orm:
    database:
      generation: none
    log:
      sql: false
      bind-parameters: true

  # Flyway Migration
  flyway:
    migrate-at-start: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  # Redis Configuration
  redis:
    hosts: redis://localhost:6379
    timeout: 10s

  # Cache Configuration
  cache:
    caffeine:
      "user-cache":
        initial-capacity: 100
        maximum-size: 1000
        expire-after-write: 10M
      "client-cache":
        initial-capacity: 50
        maximum-size: 500
        expire-after-write: 30M

  # Logging
  log:
    level: INFO
    console:
      enable: true
      format: "%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"
    category:
      "com.htv.oauth2":
        level: DEBUG
      "org.hibernate":
        level: INFO
      "io.quarkus":
        level: INFO

  # Security
  security:
    users:
      embedded:
        enabled: false

  # JWT Configuration
  smallrye-jwt:
    enabled: true

  # OpenAPI/Swagger
  smallrye-openapi:
    path: /openapi
    info-title: OAuth2 Authorization Server API
    info-version: 1.0.0
    info-description: Production-ready OAuth2 Authorization Server
    info-contact-email: admin@example.com

  swagger-ui:
    always-include: true
    path: /swagger-ui

  # Health Check
  smallrye-health:
    ui:
      enable: true

  # Metrics
  micrometer:
    enabled: true
    export:
      prometheus:
        enabled: true
        path: /metrics

  # Scheduler
  scheduler:
    enabled: true

# ============================================
# OAuth2 Custom Configuration
# ============================================

oauth2:
  # JWT Configuration
  jwt:
    issuer: https://oauth2.htv.com
    access-token-expiry: 3600      # 1 hour
    refresh-token-expiry: 86400    # 24 hours

  # Authorization Code Configuration
  authorization-code:
    validity: 300                  # 5 minutes

  # Rate Limiting
  rate-limit:
    login:
      max-attempts: 5
      window-seconds: 900          # 15 minutes
    token:
      max-requests: 100
      window-seconds: 3600         # 1 hour

  # Account Security
  security:
    max-failed-login-attempts: 5
    account-lock-duration: 900     # 15 minutes
    password-min-length: 8

  # Features
  features:
    mfa-enabled: true
    pkce-required: true

---
# ============================================
# Development Profile
# ============================================

"%dev":
  quarkus:
    datasource:
      username: postgres
      password: postgres
      jdbc:
        url: jdbc:postgresql://localhost:5432/oauth2db

    hibernate-orm:
      log:
        sql: true

    log:
      level: DEBUG
      category:
        "com.htv.oauth2":
          level: DEBUG

    smallrye-health:
      ui:
        enable: true

    redis:
      hosts: redis://localhost:6379

  oauth2:
    jwt:
      issuer: http://localhost:8080

---
# ============================================
# Test Profile
# ============================================

"%test":
  quarkus:
    datasource:
      username: test
      password: test
      jdbc:
        url: jdbc:postgresql://localhost:5433/oauth2db_test

    hibernate-orm:
      database:
        generation: drop-and-create

    flyway:
      migrate-at-start: false

    redis:
      hosts: redis://localhost:6380

  oauth2:
    jwt:
      issuer: http://localhost:8081

---
# ============================================
# Production Profile
# ============================================

"%prod":
  quarkus:
    datasource:
      username: ${DB_USERNAME}
      password: ${DB_PASSWORD}
      jdbc:
        url: ${DB_URL:jdbc:postgresql://postgres:5432/oauth2db}
        max-size: 32

    hibernate-orm:
      log:
        sql: false

    log:
      level: INFO
      category:
        "com.htv.oauth2":
          level: INFO

    http:
      port: ${PORT:8080}
      cors:
        origins: ${CORS_ORIGINS:https://app.example.com}

    redis:
      hosts: ${REDIS_URL:redis://redis:6379}
      password: ${REDIS_PASSWORD:}

  oauth2:
    jwt:
      issuer: ${JWT_ISSUER:https://oauth2.example.com}
      access-token-expiry: ${ACCESS_TOKEN_EXPIRY:3600}
      refresh-token-expiry: ${REFRESH_TOKEN_EXPIRY:86400}

    rate-limit:
      login:
        max-attempts: ${RATE_LIMIT_LOGIN_MAX:5}
      token:
        max-requests: ${RATE_LIMIT_TOKEN_MAX:100}